---
title: "DSCI 522 Milestone 1"
subtitle: Inferential Analysis for Egg Production
format:
  html:
    toc: true
editor_options:
  markdown:
    wrap: none
---

```{r load libraries, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(infer)
```

# Summary

This analysis aims to determine whether there is a difference in the mean number of eggs produced per hen between table eggs (i.e. unfertilized eggs for consumption) and hatching eggs (i.e. fertilized and will produce a chicken). The data used in this analysis was reported monthly from July 2016 to February of 2023 and was limited to the product type "all" as this includes both conventionally housed and cage-free eggs produced in the United States of America. We conducted a 1000 sample permutation to test our null-hypothesis with an observed test statistic of 5.527 and a p-value of 0. Using a significance level of 0.05 we rejected the null hypothesis in favour of the alternative and concluded that there is a significant difference in the mean number of eggs produced per hen between table and hatching eggs.

# Introduction

Type Introduction here.

# Methods

## Data

The data used in this analysis was taken from the tidytuesday repository (TidyTuesday, 2023) and was originally sourced from the Open Science Framework project by Samara Mendez (Mendez, 2023). Each row in the dataset represents summary data for the month, reporting on the type of egg (table vs hatching), the production process (conventional, cage-free, organic), the number of hens, the number of eggs and the source of the data.

## Analysis

Type here.

# Result & Discussion

#### Research Question and Hypotheses

We aimed to investigate whether there is a difference in the average number of eggs produced by each hen between hatching eggs and table eggs. To address this question, we formulated the following hypotheses:

$H_{0}$: The mean number of eggs produced by each hen for hatching, $\mu_{hatching}$, is equal to the mean number of eggs produced by each hen for table eggs, $\mu_{table}$. Mathematically, $\mu_{hatching} = \mu_{table}$.

$H_{A}$: The mean number of eggs produced by each hen for hatching, $\mu_{hatching}$, is NOT equal to the mean number of eggs produced by each hen for table eggs, $\mu_{table}$. Mathematically, $\mu_{hatching} \ne \mu_{table}$.

*where* $\mu_{hatching}$ *represents the population mean number of eggs produced by each hen for hatching, and* $\mu_{table}$ *represents the population mean number of eggs produced by each hen for table eggs.*

These hypotheses guided our analysis to determine whether a statistically significant difference exists in egg production between hatching eggs and table eggs.

#### Observed Test Statistic

To test these hypotheses, we calculated the observed test statistic $\delta^{*}$, which represents the difference between the observed mean number of eggs produced by each hen for hatching eggs and the observed mean number of eggs produced by each hen for table eggs, as derived from our egg production dataset.

The observed test statistic $\delta^{*}$ = $\hat{\mu}_\text{hatching} - \hat{\mu}_\text{table}$

#### Hypothesis Test Using the Permutation Method

With these hypotheses and observed test statistic in place, we could conduct our hypothesis test using the permutation method to draw conclusions about the potential differences in egg production between the two types.

```{r Read Data}
# read in data
egg_prod <- read_csv("../data/egg-production.csv")
egg_prod

```

In our data wrangling phase, we calculated the mean number of eggs produced per hen, recognizing that the total number of eggs depends on the number of hens involved.

Additionally, it is important to note that the "cage-free" production process is only applicable to table eggs, not hatching eggs. To ensure an fair and accurate comparison between hatching and table eggs, we filtered the dataset to include only entries where the "prod_process" variable was labeled as "all".

```{r Data Wrangling}
# create a new column to calculate the mean number of eggs produced by each hen
# Since cage-free is only available for table eggs, we filter the prod_process is equal to all 
egg_prod <- egg_prod |>
  filter(prod_process == "all") |>
  mutate(n_egg_by_hen = n_eggs / n_hens)
egg_prod
```

Subsequently, we proceeded to analyze the data by computing a test statistic, that would allow us to assess the difference in egg production between hatching and table eggs, with careful consideration of handling any missing values(NA).

```{r Calculate the Test Statistic}
# manipulate the data to calculate the test statistic
n_eggs_by_hen_set <- egg_prod |>
  group_by(prod_type) |>
  summarise(n = n(),mean_n_eggs_by_hen = mean(n_egg_by_hen, na.rm = TRUE))
test_stat <- diff(n_eggs_by_hen_set$mean_n_eggs_by_hen)
n_eggs_by_hen_set
test_stat
```

With the test statistic in hand, we can conduct our hypothesis test using the permutation method. Our approach involved generating a null distribution through 1,000 permutations, simulating the expected outcome assuming there were no difference in egg production between the two types.

```{r Hyhothesis Test, message=FALSE, warning=FALSE}
# set prod_type as factor
egg_prod <- egg_prod |>
  mutate( prod_type = factor(prod_type))

# implement Hypothesis test using the permutation
set.seed(522)
null_distribution <- egg_prod |>
  specify(formula = n_egg_by_hen ~ prod_type) |>
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "diff in means", order = c("table eggs", "hatching eggs"))

# calculate the p-value
p_value <- null_distribution |>
  get_pvalue(obs_stat = test_stat, direction = "both")

p_value

```

The p-value obtained from our hypothesis test is 0, which is an extremely rare occurrence. Given that our defined significance threshold $\alpha$ is 0.05, we can reject the null hypothesis $H_{0}$(there is no difference in the average number of eggs produced by each hen between hatching eggs and table eggs) in favour of the alternative hypothesis $H_{A}$.

In practical terms, this means that hatching eggs and table eggs do indeed exhibit distinct patterns of egg production by each hen.

# References

Mendez, S. (2023, April 9). *US Egg Production Data Set*. Open Science Framework. https://osf.io/z2gxn/

TidyTuesday. (2023, April). *US Egg Production*. rfordatascience/tidytuesday. https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-11/readme.md
